import * as m from "zigbee-herdsman-converters/lib/modernExtend";
import { Zcl } from "zigbee-herdsman";
import * as e from "zigbee-herdsman-converters/lib/exposes";
import { access as ea } from "zigbee-herdsman-converters/lib/exposes";
import {logger} from "zigbee-herdsman-converters/lib/logger";
import * as utils from "zigbee-herdsman-converters/lib/utils";
/* ------------------ endpoints ------------------ */

const wledEndpoints = [1, 2, 3];

/* ------------------ cluster / attrs ------------------ */

const clst = {
  manuLightMode: 0xfce2,
    manuMediaPlayer: 0xfcf1
    };

    const attr = {
      lightMode: 0xfce3,
        lightInterval: 0xfce4,
          mediaState: 0xfcf2, // char string
            mediaCommand: 0xfcf3, // enum8
              mediaVolume: 0xfcf4, // uint8 (0–30)
                mediaTrackCount: 0xfcf5, // uint16 (ro)
                  mediaTrack: 0xfcf6, // uint16 (ro)
                    mediaPlayMode: 0xfcf7, // enum8
                    };

                    /* ------------------ lookup ------------------ */

                    const effectLookup = {
                      steady: 0,
                        blinking: 1,
                          breathing: 2,
                            flashing: 3,
                              twinkle: 4,
                              };

                              const effectLookupReverse = Object.fromEntries(
                                Object.entries(effectLookup).map(([k, v]) => [v, k])
                                );

                                const mediaCommandLookup = {
                                  "⏮ prev": 0,
                                    "▶ play": 1,
                                      "⏸ pause": 2,
                                        "⏹ stop": 3,
                                          "⏭ next": 4,
                                          };

                                          const mediaCommandLookupReverse = Object.fromEntries(
                                            Object.entries(mediaCommandLookup).map(([k, v]) => [v, k])
                                            );

                                            const mediaStateLookup = {
                                                0: "UNKNOWN",  // driver not ready / unknown
                                                    1: "STOP",     // normal playback stopped
                                                        2: "PLAY",     // playing
                                                            3: "PAUSE",    // paused
                                                                4: "NO_MEDIA", // no media
                                                                    5: "ERROR",    // hardware or driver error
                                                                    };

                                                                    // Reverse lookup for sending commands
                                                                    const mediaStateLookupReverse = Object.fromEntries(
                                                                        Object.entries(mediaStateLookup).map(([k, v]) => [v, Number(k)])
                                                                        );

                                                                        const mediaPlayModeLookup = {
                                                                            0: "play one",    // play current track once, stop
                                                                                1: "play all",    // play all tracks sequentially
                                                                                    2: "repeat one",  // loop current track
                                                                                        3: "repeat all",  // loop all tracks
                                                                                            4: "shuffle all", // random / shuffle all tracks
                                                                                            };

                                                                                            // Reverse lookup for sending commands
                                                                                            const mediaPlayModeLookupReverse = Object.fromEntries(
                                                                                                Object.entries(mediaPlayModeLookup).map(([k, v]) => [v, Number(k)])
                                                                                                );

                                                                                                /* ------------------ effect converters (z2m standard m.enumLookup seems to ignore multi endpoints) ------------------ */

                                                                                                const tzEffect = {
                                                                                                  key: ["effect"],
                                                                                                    convertSet: async (entity, key, value, meta) => {
                                                                                                        const ep = utils.determineEndpoint(entity, meta, clst.manuLightMode);
                                                                                                            await ep.write(
                                                                                                                  clst.manuLightMode,
                                                                                                                        {
                                                                                                                                [attr.lightMode]: {
                                                                                                                                          value: effectLookup[value],
                                                                                                                                                    type: Zcl.DataType.ENUM8,
                                                                                                                                                            },
                                                                                                                                                                  }
                                                                                                                                                                      );
                                                                                                                                                                          return { state: { [key]: value } };
                                                                                                                                                                            },
                                                                                                                                                                            };


                                                                                                                                                                            const fzEffect = {
                                                                                                                                                                              cluster: clst.manuLightMode,
                                                                                                                                                                                type: ["attributeReport", "readResponse"],
                                                                                                                                                                                  convert: (model, msg, publish, options, meta) => {
                                                                                                                                                                                      const raw = msg.data?.[attr.lightMode];
                                                                                                                                                                                          if (raw === undefined) return;
                                                                                                                                                                                              const effect = effectLookupReverse[raw];
                                                                                                                                                                                                  if (effect === undefined) return;
                                                                                                                                                                                                      return {
                                                                                                                                                                                                            effect,
                                                                                                                                                                                                                };
                                                                                                                                                                                                                  },
                                                                                                                                                                                                                  };

                                                                                                                                                                                                                  /* ------------------ media players converters ------------------ */

                                                                                                                                                                                                                  const tzMediaCommand = {
                                                                                                                                                                                                                    key: ['media_command'],
                                                                                                                                                                                                                      convertSet: async (entity, key, value, meta) => {
                                                                                                                                                                                                                          const ep = utils.determineEndpoint(entity, meta, clst.manuMediaPlayer);
                                                                                                                                                                                                                              await ep.write(
                                                                                                                                                                                                                                    clst.manuMediaPlayer,
                                                                                                                                                                                                                                          {
                                                                                                                                                                                                                                                  [attr.mediaCommand]: {
                                                                                                                                                                                                                                                            value: mediaCommandLookup[value],
                                                                                                                                                                                                                                                                      type: Zcl.DataType.ENUM8,
                                                                                                                                                                                                                                                                              },
                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                        );
                                                                                                                                                                                                                                                                                            return { state: { [key]: value } };
                                                                                                                                                                                                                                                                                              },
                                                                                                                                                                                                                                                                                              };

                                                                                                                                                                                                                                                                                              /* ------------------ exposes ------------------ */

                                                                                                                                                                                                                                                                                              const wledConverters = wledEndpoints.flatMap((ep) => [
                                                                                                                                                                                                                                                                                                m.light({
                                                                                                                                                                                                                                                                                                    endpointNames: [`wled_${ep}`],
                                                                                                                                                                                                                                                                                                        effect: false,
                                                                                                                                                                                                                                                                                                            powerOnBehavior: true,
                                                                                                                                                                                                                                                                                                              }),
                                                                                                                                                                                                                                                                                                                m.enumLookup({
                                                                                                                                                                                                                                                                                                                    name: "effect",
                                                                                                                                                                                                                                                                                                                        label: "Light Options - Mode",
                                                                                                                                                                                                                                                                                                                            description:
                                                                                                                                                                                                                                                                                                                                  "Sets light mode (e.g. steady, blinking, ...) !!z2m gui is not workign correctly, HA entities work as expected - dont use here !!",
                                                                                                                                                                                                                                                                                                                                      lookup: effectLookup,
                                                                                                                                                                                                                                                                                                                                          endpointNames: [`wled_${ep}`],
                                                                                                                                                                                                                                                                                                                                              cluster: clst.manuLightMode,
                                                                                                                                                                                                                                                                                                                                                  attribute: { ID: attr.lightMode, type: Zcl.DataType.ENUM8 },
                                                                                                                                                                                                                                                                                                                                                      access: "ALL",
                                                                                                                                                                                                                                                                                                                                                        }),
                                                                                                                                                                                                                                                                                                                                                          m.numeric({
                                                                                                                                                                                                                                                                                                                                                              name: "light_mode_interval",
                                                                                                                                                                                                                                                                                                                                                                  label: "Light Options - Interval",
                                                                                                                                                                                                                                                                                                                                                                      description: "Length of mode effects in ms (n/a for mode steady)",
                                                                                                                                                                                                                                                                                                                                                                          unit: "ms",
                                                                                                                                                                                                                                                                                                                                                                              valueMin: 500,
                                                                                                                                                                                                                                                                                                                                                                                  valueMax: 60000,
                                                                                                                                                                                                                                                                                                                                                                                      valueStep: 500,
                                                                                                                                                                                                                                                                                                                                                                                          entityCategory: "config",
                                                                                                                                                                                                                                                                                                                                                                                              endpointNames: [`wled_${ep}`],
                                                                                                                                                                                                                                                                                                                                                                                                  cluster: clst.manuLightMode,
                                                                                                                                                                                                                                                                                                                                                                                                      attribute: { ID: attr.lightInterval, type: Zcl.DataType.UINT16 },
                                                                                                                                                                                                                                                                                                                                                                                                          access: "ALL",
                                                                                                                                                                                                                                                                                                                                                                                                            }),
                                                                                                                                                                                                                                                                                                                                                                                                            ]);


                                                                                                                                                                                                                                                                                                                                                                                                            /* ------------------ media exposes ------------------ */

                                                                                                                                                                                                                                                                                                                                                                                                            const mediaExposes = [  
                                                                                                                                                                                                                                                                                                                                                                                                              m.enumLookup({
                                                                                                                                                                                                                                                                                                                                                                                                                  name: 'media_command',
                                                                                                                                                                                                                                                                                                                                                                                                                      label: 'Media Player Command (Endpoint: media)',
                                                                                                                                                                                                                                                                                                                                                                                                                          description: "",
                                                                                                                                                                                                                                                                                                                                                                                                                              lookup: mediaCommandLookup,
                                                                                                                                                                                                                                                                                                                                                                                                                                  endpointNames: ['media'],
                                                                                                                                                                                                                                                                                                                                                                                                                                      cluster: clst.manuMediaPlayer,
                                                                                                                                                                                                                                                                                                                                                                                                                                          attribute: { ID: attr.mediaCommand, type: Zcl.DataType.ENUM8 },    
                                                                                                                                                                                                                                                                                                                                                                                                                                              access: "SET",
                                                                                                                                                                                                                                                                                                                                                                                                                                                }),  
                                                                                                                                                                                                                                                                                                                                                                                                                                                  m.enumLookup({
                                                                                                                                                                                                                                                                                                                                                                                                                                                      name: 'media_playmode',
                                                                                                                                                                                                                                                                                                                                                                                                                                                          label: 'Playback Mode (Endpoint: media)',
                                                                                                                                                                                                                                                                                                                                                                                                                                                              description: "",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                  lookup: mediaPlayModeLookupReverse,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                      endpointNames: ['media'],
                                                                                                                                                                                                                                                                                                                                                                                                                                                                          cluster: clst.manuMediaPlayer,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                              attribute: { ID: attr.mediaPlayMode, type: Zcl.DataType.ENUM8 },    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  access: "ALL",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }),  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      m.enumLookup({
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          name: 'media_state',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              label: 'Media Player State',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  description: "",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      lookup: mediaStateLookupReverse,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          endpointNames: ['media'],
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              cluster: clst.manuMediaPlayer,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  attribute: { ID: attr.mediaState, type: Zcl.DataType.ENUM8 },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      access: "STATE_GET",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }),  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          m.numeric({ // Track count (read-only)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              name: 'track',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  label: 'Current Track Number',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      description: "",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          endpointNames: ['media'],
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              cluster: clst.manuMediaPlayer,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  attribute: { ID: attr.mediaTrack, type: Zcl.DataType.UINT16 },    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      access: "STATE_GET",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          m.numeric({ // Track count (read-only)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              name: 'track_count',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  label: 'Track Count',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      description: "",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          endpointNames: ['media'],
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              cluster: clst.manuMediaPlayer,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  attribute: { ID: attr.mediaTrackCount, type: Zcl.DataType.UINT16 },    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      access: "STATE_GET",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          m.numeric({
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              name: 'volume',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  label: 'Volume',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      description: "",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          unit: "",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              valueMin: 0,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  valueMax: 30,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      valueStep: 1,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          entityCategory: "config",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              endpointNames: ['media'],
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  cluster: clst.manuMediaPlayer,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      attribute: { ID: attr.mediaVolume, type: Zcl.DataType.UINT8 },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          access: "ALL",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }),  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ];


                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            /* ------------------ device ------------------ */

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            export default {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              zigbeeModel: ["XMasScene"],
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                model: "XMasScene",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  vendor: "FUNAMI corp. Ltd.",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    description: "XMas light and sound controller.",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ota: true,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        toZigbee: [
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            tzEffect,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                tzMediaCommand,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ],
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    fromZigbee: [
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        fzEffect,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ],
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            extend: [
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                m.deviceEndpoints({
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      endpoints: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              wled_1: 1,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      wled_2: 2,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              wled_3: 3,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      pir: 10,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              media: 20,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ...wledConverters,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ...mediaExposes,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    m.occupancy({ endpointNames: ["pir"] }),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        m.identify({ endpointNames: ["wled_2"] }),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ],
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            meta: { multiEndpoint: true },

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              configure: async (device, coordinatorEndpoint) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  for (const epNum of wledEndpoints) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const ep = device.getEndpoint(epNum);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              await ep.read("genBasic", [
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      "modelId",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              "swBuildId",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      "dateCode",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              "powerSource",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ]);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          await ep.read("genOnOff", ["onOff"]);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                await ep.read("genLevelCtrl", ["currentLevel"]);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      await ep.read(clst.manuLightMode, [attr.lightMode]);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            await ep.configureReporting("genOnOff", [
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              attribute: "onOff",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        minimumReportInterval: 0,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  maximumReportInterval: 65534,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            reportableChange: 1,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ]);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                await ep.configureReporting("genLevelCtrl", [
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  attribute: "currentLevel",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            minimumReportInterval: 0,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      maximumReportInterval: 65534,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                reportableChange: 1,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ]);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    await ep.configureReporting(clst.manuLightMode, [
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      attribute: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ID: attr.lightMode,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              type: Zcl.DataType.ENUM8,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  minimumReportInterval: 0,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            maximumReportInterval: 65534,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      reportableChange: 1,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ]);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          await ep.bind(clst.manuLightMode, coordinatorEndpoint);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                await ep.bind("genOnOff", coordinatorEndpoint);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      await ep.bind("genLevelCtrl", coordinatorEndpoint);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              const ep20 = device.getEndpoint(20);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  await ep20.read(clst.manuMediaPlayer, [
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        attr.mediaState,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              attr.mediaVolume,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    attr.mediaTrack,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          attr.mediaTrackCount,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                attr.mediaPlayMode,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ]);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        await ep20.configureReporting(clst.manuMediaPlayer, [
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      attribute: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ID: attr.mediaState,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          type: Zcl.DataType.ENUM8,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          minimumReportInterval: 0,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  maximumReportInterval: 65534,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          reportableChange: 1, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              attribute: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ID: attr.mediaPlayMode,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  type: Zcl.DataType.ENUM8,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  minimumReportInterval: 0,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          maximumReportInterval: 65534,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  reportableChange: 1, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      attribute: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ID: attr.mediaVolume,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          type: Zcl.DataType.UINT8,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          minimumReportInterval: 0,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  maximumReportInterval: 65534,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          reportableChange: 1,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              attribute: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ID: attr.mediaTrack,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  type: Zcl.DataType.UINT16,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  minimumReportInterval: 0,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          maximumReportInterval: 65534,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  reportableChange: 1,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      attribute: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ID: attr.mediaTrackCount,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          type: Zcl.DataType.UINT16,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          minimumReportInterval: 0,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  maximumReportInterval: 65534,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          reportableChange: 1,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ]);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        await ep20.bind(clst.manuMediaPlayer, coordinatorEndpoint);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          };
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          